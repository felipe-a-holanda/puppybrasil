#!/bin/sh
#Barry Kauler 2008.
#firstly, JM's code to setup #puppylinux at IRC, then launch pidgin.

#########################
# gaim-autosetup.sh -- generates autologin configuration for GAIM 
#                      so that starting GAIM will log user into #puppylinux
#
# Copyright 2006 Jonathan Marsden, GNU General Public License version 2
# FSF Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
# bugfix bk 2006. Modified for Pidgin 2008.
# Modified by wolf_pup 07-18-2008 for ayttm :D

BACKTITLE="Welcome, this will setup ayttm to automatically connect
you to the #puppylinux support channel at irc.freenode.net.
Type the nickname that you would like to be known by.
The entry already in the box has been autogenerated."
IRCHOST='irc.freenode.net'
IRCCHANNEL='#puppylinux'
IRCPORT=6667
PREFIX='pupuser-'
AYTTMCONFIGDIR=$HOME/.ayttm
PROMPT="WARNING: This channel is not officially sanctioned or supported
by the developers of the Puppy-based distros. There is no
moderation and many posts are irrelevant to Puppy (to put it
nicely). The recommended place for support is the Puppy Forum.

Enter the IRC Nickname you wish to use,
as unique as possible to avoid conflict
with already-registered names:"

mkdir $AYTTMCONFIGDIR

# Exit if either of the two files we are generating already exists
[ -f $AYTTMCONFIGDIR/accounts ] && exec ayttm "$@"
[ -f $AYTTMCONFIGDIR/chatroom_autoconnect ] && exec ayttm "$@"

# Generate a semi-random IRC username

USERNAME=$PREFIX`(date ;cat /proc/cpuinfo)|md5sum|sed -e's/^\(......\).*$/\1/'`

NEWNAME=`Xdialog --backtitle "$BACKTITLE" --stdout --no-cancel --title "Ayttm startup" --inputbox "$PROMPT" 0 0 "$USERNAME"`

[ $? -ne 0 ] && exec ayttm "$@"
[ "$NEWNAME" = "" ] && exec ayttm "$@"

USERNAME=`echo "$NEWNAME" |tr -cd 'A-Za-z0-9[-\`{-}'` # See RFC 2812 2.3.1

# Create the three config files
cat >$AYTTMCONFIGDIR/accounts <<EOF
<ACCOUNT IRC>
	SCREEN_NAME="$USERNAME"
	PASSWORD=""
	irc_host="$IRCHOST"
	irc_port="$IRCPORT"
	CONNECT="1"
</ACCOUNT>
EOF

cat >$AYTTMCONFIGDIR/chatroom_autoconnect <<EOF
IRC	$USERNAME	$IRCCHANNEL	0	--
EOF

cat >$AYTTMCONFIGDIR/prefs <<EOF
x_contact_window=479
y_contact_window=348
status_show_level=0
do_typing_notify=1
do_send_typing_notify=1
do_escape_close=1
do_convo_timestamp=1
do_enter_send=1
do_ignore_unknown=0
do_multi_line=1
do_raise_window=0
do_send_idle_time=0
do_timestamp=0
do_ignore_fore=0
do_ignore_back=0
do_ignore_font=0
do_auto_complete=1
do_smiley=1
FontFace=DejaVu Sans 11
do_logging=0
do_strip_html=0
do_restore_last_conv=0
do_tabbed_chat=1
do_tabbed_chat_orient=1
accel_next_tab=<Control>Right
accel_prev_tab=<Control>Left
do_no_sound_when_away=0
do_no_sound_for_ignore=1
do_online_sound=1
do_play_send=1
do_play_first=1
do_play_receive=1
BuddyArriveFilename=/usr/share/ayttm/sounds/BuddyArrive.au
BuddyAwayFilename=/usr/share/ayttm/sounds/BuddyLeave.au
BuddyLeaveFilename=/usr/share/ayttm/sounds/BuddyLeave.au
SendFilename=/usr/share/ayttm/sounds/Send.au
ReceiveFilename=/usr/share/ayttm/sounds/Receive.au
FirstMsgFilename=/usr/share/ayttm/sounds/Receive.au
SoundVolume=0.000000
do_ayttm_debug=0
do_ayttm_debug_html=0
do_plugin_debug=0
do_version_check=0
usercount_window_seen=0
length_contact_window=256
width_contact_window=246
do_noautoresize=0
do_show_tooltips=1
use_alternate_browser=1
alternate_browser=/usr/local/bin/defaultbrowser %s
proxy_type=0
proxy_host=
proxy_port=3128
do_proxy_auth=0
proxy_user=
proxy_password=
use_recoding=0
local_encoding=
remote_encoding=
last_warned_version=0.5.0-45
modules_path=/usr/lib/ayttm
plugins
	/usr/lib/ayttm/smiley-themer.la
		smiley_directory="/usr/share/ayttm/smileys"
		last_selected="Console Smileys"
		do_smiley_debug="0"
		load="1"
	end
	/usr/lib/ayttm/aim-toc.la
		aim_server="toc.oscar.aol.com"
		aim_port="80"
		do_aim_debug="0"
		load="1"
	end
	/usr/lib/ayttm/msn2.la
		msn_server="messenger.hotmail.com"
		msn_port="1863"
		do_guess_away="0"
		do_check_connection="0"
		do_reconnect="0"
		do_rename_contacts="0"
		do_msn_debug="0"
		load="1"
	end
	/usr/lib/ayttm/importicq.la
		load="1"
	end
	/usr/lib/ayttm/custmsg.la
		custom_away_msg=""
		enable_plugin="0"
		load="1"
	end
	/usr/lib/ayttm/rainbow.la
		doRainbow="0"
		sstart_r="255"
		sstart_g="0"
		sstart_b="0"
		send_r="0"
		send_g="0"
		send_b="255"
		load="1"
	end
	/usr/lib/ayttm/video_capture.la
		frame_grabber="/usr/bin/ayttm_streamer_wrapper.sh -d %d"
		load="1"
	end
	/usr/lib/ayttm/yahoo2.la
		pager_host="scs.msg.yahoo.com"
		pager_port="5050"
		filetransfer_host="filetransfer.msg.yahoo.com"
		filetransfer_port="80"
		webcam_host="webcam.yahoo.com"
		webcam_port="5100"
		conn_type="0"
		do_prompt_save_file="1"
		do_guess_away="0"
		do_show_away_time="0"
		do_yahoo_debug="0"
		load="1"
	end
	/usr/lib/ayttm/icq-toc.la
		icq_server="toc.oscar.aol.com"
		icq_port="80"
		do_icq_debug="0"
		load="1"
	end
	/usr/lib/ayttm/jabber.la
		jabber_server="jabber.com"
		do_jabber_debug="0"
		load="1"
	end
	/usr/lib/ayttm/notes.la
		notes_editor="/usr/local/bin/defaulttexteditor %s"
		load="1"
	end
	/usr/lib/ayttm/irc.la
		do_irc_debug="0"
		load="1"
	end
	/usr/lib/ayttm/import_gaim.la
		load="1"
	end
	/usr/lib/ayttm/middle.la
		s_doLeet="0"
		s_doExtremeLeet="0"
		load="1"
	end
	/usr/lib/ayttm/autotrans.la
		doTrans="0"
		myLanguage="0"
		load="1"
	end
	/usr/lib/ayttm/importlicq.la
		load="1"
	end
	/usr/lib/ayttm/import_gnomeicu.la
		load="1"
	end
	/usr/lib/ayttm/import_everybuddy.la
		load="1"
	end
end

EOF
##############################

#now run ayttm...
exec ayttm "$@"

###END###
